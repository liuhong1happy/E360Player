// threejs.org/license
(function(h,oa){"object"===typeof exports&&"undefined"!==typeof module?oa(exports):"function"===typeof define&&define.amd?define(["exports"],oa):oa(h.THREE=h.THREE||{})})(this,function(h){function oa(){}function C(a,b){this.x=a||0;this.y=b||0}function Z(a,b,c,d,e,f,g,k,l,m){Object.defineProperty(this,"id",{value:Qd++});this.uuid=h.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==a?a:Z.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:Z.DEFAULT_MAPPING;this.wrapS=void 0!==
c?c:1001;this.wrapT=void 0!==d?d:1001;this.magFilter=void 0!==e?e:1006;this.minFilter=void 0!==f?f:1008;this.anisotropy=void 0!==l?l:1;this.format=void 0!==g?g:1023;this.type=void 0!==k?k:1009;this.offset=new C(0,0);this.repeat=new C(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==m?m:3E3;this.version=0;this.onUpdate=null}function R(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}
function ia(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1}function q(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}function Rd(a,b){var c,d,e,f,g,k,l,m,r,p,n,h,u,v,y,w,x;function N(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var z=a.context,F=a.state,G,D,K,Ea,I=new q,da=new ia,ba=new q;this.render=function(q,Da){if(0!==b.length){if(void 0===K){var M=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),O=new Uint16Array([0,
1,2,0,2,3]);G=z.createBuffer();D=z.createBuffer();z.bindBuffer(z.ARRAY_BUFFER,G);z.bufferData(z.ARRAY_BUFFER,M,z.STATIC_DRAW);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,D);z.bufferData(z.ELEMENT_ARRAY_BUFFER,O,z.STATIC_DRAW);var M=z.createProgram(),O=z.createShader(z.VERTEX_SHADER),P=z.createShader(z.FRAGMENT_SHADER);z.shaderSource(O,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
z.shaderSource(P,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
z.compileShader(O);z.compileShader(P);z.attachShader(M,O);z.attachShader(M,P);z.linkProgram(M);K=M;w=z.getAttribLocation(K,"position");x=z.getAttribLocation(K,"uv");c=z.getUniformLocation(K,"uvOffset");d=z.getUniformLocation(K,"uvScale");e=z.getUniformLocation(K,"rotation");f=z.getUniformLocation(K,"scale");g=z.getUniformLocation(K,"color");k=z.getUniformLocation(K,"map");l=z.getUniformLocation(K,"opacity");m=z.getUniformLocation(K,"modelViewMatrix");r=z.getUniformLocation(K,"projectionMatrix");p=
z.getUniformLocation(K,"fogType");n=z.getUniformLocation(K,"fogDensity");h=z.getUniformLocation(K,"fogNear");u=z.getUniformLocation(K,"fogFar");v=z.getUniformLocation(K,"fogColor");y=z.getUniformLocation(K,"alphaTest");M=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");M.width=8;M.height=8;O=M.getContext("2d");O.fillStyle="white";O.fillRect(0,0,8,8);Ea=new Z(M);Ea.needsUpdate=!0}z.useProgram(K);F.initAttributes();F.enableAttribute(w);F.enableAttribute(x);F.disableUnusedAttributes();
F.disable(z.CULL_FACE);F.enable(z.BLEND);z.bindBuffer(z.ARRAY_BUFFER,G);z.vertexAttribPointer(w,2,z.FLOAT,!1,16,0);z.vertexAttribPointer(x,2,z.FLOAT,!1,16,8);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,D);z.uniformMatrix4fv(r,!1,Da.projectionMatrix.elements);F.activeTexture(z.TEXTURE0);z.uniform1i(k,0);O=M=0;(P=q.fog)?(z.uniform3f(v,P.color.r,P.color.g,P.color.b),P&&P.isFog?(z.uniform1f(h,P.near),z.uniform1f(u,P.far),z.uniform1i(p,1),O=M=1):P&&P.isFogExp2&&(z.uniform1f(n,P.density),z.uniform1i(p,2),O=M=2)):
(z.uniform1i(p,0),O=M=0);for(var P=0,S=b.length;P<S;P++){var C=b[P];C.modelViewMatrix.multiplyMatrices(Da.matrixWorldInverse,C.matrixWorld);C.z=-C.modelViewMatrix.elements[14]}b.sort(N);for(var V=[],P=0,S=b.length;P<S;P++){var C=b[P],W=C.material;!1!==W.visible&&(z.uniform1f(y,W.alphaTest),z.uniformMatrix4fv(m,!1,C.modelViewMatrix.elements),C.matrixWorld.decompose(I,da,ba),V[0]=ba.x,V[1]=ba.y,C=0,q.fog&&W.fog&&(C=O),M!==C&&(z.uniform1i(p,C),M=C),null!==W.map?(z.uniform2f(c,W.map.offset.x,W.map.offset.y),
z.uniform2f(d,W.map.repeat.x,W.map.repeat.y)):(z.uniform2f(c,0,0),z.uniform2f(d,1,1)),z.uniform1f(l,W.opacity),z.uniform3f(g,W.color.r,W.color.g,W.color.b),z.uniform1f(e,W.rotation),z.uniform2fv(f,V),F.setBlending(W.blending,W.blendEquation,W.blendSrc,W.blendDst),F.setDepthTest(W.depthTest),F.setDepthWrite(W.depthWrite),W.map?a.setTexture2D(W.map,0):a.setTexture2D(Ea,0),z.drawElements(z.TRIANGLES,6,z.UNSIGNED_SHORT,0))}F.enable(z.CULL_FACE);a.resetGLState()}}}function Rb(a,b){this.min=void 0!==a?
a:new C(Infinity,Infinity);this.max=void 0!==b?b:new C(-Infinity,-Infinity)}function Sd(a,b){var c,d,e,f,g,k,l,m,r,p,n=a.context,h=a.state,u,v,y,w,x,N;this.render=function(z,F,G){if(0!==b.length){z=new q;var D=G.w/G.z,K=.5*G.z,Ea=.5*G.w,I=16/G.w,da=new C(I*D,I),ba=new q(1,1,0),Ua=new C(1,1),Da=new Rb;Da.min.set(0,0);Da.max.set(G.z-16,G.w-16);if(void 0===w){var I=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),M=new Uint16Array([0,1,2,0,2,3]);u=n.createBuffer();v=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,
u);n.bufferData(n.ARRAY_BUFFER,I,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v);n.bufferData(n.ELEMENT_ARRAY_BUFFER,M,n.STATIC_DRAW);x=n.createTexture();N=n.createTexture();h.bindTexture(n.TEXTURE_2D,x);n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,
n.NEAREST);h.bindTexture(n.TEXTURE_2D,N);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);var I=y={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},M=n.createProgram(),O=n.createShader(n.FRAGMENT_SHADER),
P=n.createShader(n.VERTEX_SHADER),S="precision "+a.getPrecision()+" float;\n";n.shaderSource(O,S+I.fragmentShader);n.shaderSource(P,S+I.vertexShader);n.compileShader(O);n.compileShader(P);n.attachShader(M,O);n.attachShader(M,P);n.linkProgram(M);w=M;r=n.getAttribLocation(w,"position");p=n.getAttribLocation(w,"uv");c=n.getUniformLocation(w,"renderType");d=n.getUniformLocation(w,"map");e=n.getUniformLocation(w,"occlusionMap");f=n.getUniformLocation(w,"opacity");g=n.getUniformLocation(w,"color");k=n.getUniformLocation(w,
"scale");l=n.getUniformLocation(w,"rotation");m=n.getUniformLocation(w,"screenPosition")}n.useProgram(w);h.initAttributes();h.enableAttribute(r);h.enableAttribute(p);h.disableUnusedAttributes();n.uniform1i(e,0);n.uniform1i(d,1);n.bindBuffer(n.ARRAY_BUFFER,u);n.vertexAttribPointer(r,2,n.FLOAT,!1,16,0);n.vertexAttribPointer(p,2,n.FLOAT,!1,16,8);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v);h.disable(n.CULL_FACE);h.setDepthWrite(!1);M=0;for(O=b.length;M<O;M++)if(I=16/G.w,da.set(I*D,I),P=b[M],z.set(P.matrixWorld.elements[12],
P.matrixWorld.elements[13],P.matrixWorld.elements[14]),z.applyMatrix4(F.matrixWorldInverse),z.applyProjection(F.projectionMatrix),ba.copy(z),Ua.x=G.x+ba.x*K+K-8,Ua.y=G.y+ba.y*Ea+Ea-8,!0===Da.containsPoint(Ua)){h.activeTexture(n.TEXTURE0);h.bindTexture(n.TEXTURE_2D,null);h.activeTexture(n.TEXTURE1);h.bindTexture(n.TEXTURE_2D,x);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,Ua.x,Ua.y,16,16,0);n.uniform1i(c,0);n.uniform2f(k,da.x,da.y);n.uniform3f(m,ba.x,ba.y,ba.z);h.disable(n.BLEND);h.enable(n.DEPTH_TEST);n.drawElements(n.TRIANGLES,
6,n.UNSIGNED_SHORT,0);h.activeTexture(n.TEXTURE0);h.bindTexture(n.TEXTURE_2D,N);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,Ua.x,Ua.y,16,16,0);n.uniform1i(c,1);h.disable(n.DEPTH_TEST);h.activeTexture(n.TEXTURE1);h.bindTexture(n.TEXTURE_2D,x);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);P.positionScreen.copy(ba);P.customUpdateCallback?P.customUpdateCallback(P):P.updateLensFlares();n.uniform1i(c,2);h.enable(n.BLEND);for(var S=0,B=P.lensFlares.length;S<B;S++){var V=P.lensFlares[S];.001<V.opacity&&.001<
V.scale&&(ba.x=V.x,ba.y=V.y,ba.z=V.z,I=V.size*V.scale/G.w,da.x=I*D,da.y=I,n.uniform3f(m,ba.x,ba.y,ba.z),n.uniform2f(k,da.x,da.y),n.uniform1f(l,V.rotation),n.uniform1f(f,V.opacity),n.uniform3f(g,V.color.r,V.color.g,V.color.b),h.setBlending(V.blending,V.blendEquation,V.blendSrc,V.blendDst),a.setTexture2D(V.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}}h.enable(n.CULL_FACE);h.enable(n.DEPTH_TEST);h.setDepthWrite(!0);a.resetGLState()}}}function Ra(a,b,c,d,e,f,g,k,l,m){a=void 0!==a?a:[];
Z.call(this,a,void 0!==b?b:301,c,d,e,f,g,k,l,m);this.flipY=!1}function lb(a,b,c){var d=a[0];if(0>=d||0<d)return a;var e=b*c,f=Td[e];void 0===f&&(f=new Float32Array(e),Td[e]=f);if(0!==b)for(d.toArray(f,0),d=1,e=0;d!==b;++d)e+=c,a[d].toArray(f,e);return f}function Ud(a,b){var c=Vd[b];void 0===c&&(c=new Int32Array(b),Vd[b]=c);for(var d=0;d!==b;++d)c[d]=a.allocTextureUnit();return c}function De(a,b){a.uniform1f(this.addr,b)}function Ee(a,b){a.uniform1i(this.addr,b)}function Fe(a,b){void 0===b.x?a.uniform2fv(this.addr,
b):a.uniform2f(this.addr,b.x,b.y)}function Ge(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)}function He(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)}function Ie(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)}function Je(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)}function Ke(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)}function Le(a,b,c){var d=c.allocTextureUnit();
a.uniform1i(this.addr,d);c.setTexture2D(b||Wd,d)}function Me(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,d);c.setTextureCube(b||Xd,d)}function Yd(a,b){a.uniform2iv(this.addr,b)}function Zd(a,b){a.uniform3iv(this.addr,b)}function $d(a,b){a.uniform4iv(this.addr,b)}function Ne(a){switch(a){case 5126:return De;case 35664:return Fe;case 35665:return Ge;case 35666:return He;case 35674:return Ie;case 35675:return Je;case 35676:return Ke;case 35678:return Le;case 35680:return Me;case 5124:case 35670:return Ee;
case 35667:case 35671:return Yd;case 35668:case 35672:return Zd;case 35669:case 35673:return $d}}function Oe(a,b){a.uniform1fv(this.addr,b)}function Pe(a,b){a.uniform1iv(this.addr,b)}function Qe(a,b){a.uniform2fv(this.addr,lb(b,this.size,2))}function Re(a,b){a.uniform3fv(this.addr,lb(b,this.size,3))}function Se(a,b){a.uniform4fv(this.addr,lb(b,this.size,4))}function Te(a,b){a.uniformMatrix2fv(this.addr,!1,lb(b,this.size,4))}function Ue(a,b){a.uniformMatrix3fv(this.addr,!1,lb(b,this.size,9))}function Ve(a,
b){a.uniformMatrix4fv(this.addr,!1,lb(b,this.size,16))}function We(a,b,c){var d=b.length,e=Ud(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.setTexture2D(b[a]||Wd,e[a])}function Xe(a,b,c){var d=b.length,e=Ud(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.setTextureCube(b[a]||Xd,e[a])}function Ye(a){switch(a){case 5126:return Oe;case 35664:return Qe;case 35665:return Re;case 35666:return Se;case 35674:return Te;case 35675:return Ue;case 35676:return Ve;case 35678:return We;case 35680:return Xe;
case 5124:case 35670:return Pe;case 35667:case 35671:return Yd;case 35668:case 35672:return Zd;case 35669:case 35673:return $d}}function Ze(a,b,c){this.id=a;this.addr=c;this.setValue=Ne(b.type)}function $e(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=Ye(b.type)}function ae(a){this.id=a;this.seq=[];this.map={}}function Fa(a,b,c){this.seq=[];this.map={};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,
e.name),g=this,k=e.name,l=k.length;for(ld.lastIndex=0;;){var m=ld.exec(k),r=ld.lastIndex,h=m[1],n=m[3];"]"===m[2]&&(h|=0);if(void 0===n||"["===n&&r+2===l){k=g;e=void 0===n?new Ze(h,e,f):new $e(h,e,f);k.seq.push(e);k.map[e.id]=e;break}else n=g.map[h],void 0===n&&(n=new ae(h),h=g,g=n,h.seq.push(g),h.map[g.id]=g),g=n}}}function be(a,b,c,d,e,f,g){function k(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");d.width=Math.floor(a.width*
c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height,a);return d}return a}function l(a){return h.Math.isPowerOfTwo(a.width)&&h.Math.isPowerOfTwo(a.height)}function m(b){return 1003===b||1004===b||1005===b?a.NEAREST:a.LINEAR}function r(b){b=b.target;b.removeEventListener("dispose",r);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);
else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d["delete"](b)}y.textures--}function p(b){b=b.target;b.removeEventListener("dispose",p);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==e.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b&&b.isWebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),
c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d["delete"](b.texture);d["delete"](b)}y.textures--}function n(b,g){var m=d.get(b);if(0<b.version&&m.__version!==b.version){var n=b.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",b);else if(!1===n.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",b);else{void 0===m.__webglInit&&(m.__webglInit=!0,b.addEventListener("dispose",r),m.__webglTexture=
a.createTexture(),y.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);var p=k(b.image,e.maxTextureSize);if((1001!==b.wrapS||1001!==b.wrapT||1003!==b.minFilter&&1006!==b.minFilter)&&!1===l(p))if(n=p,n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){var u=document.createElementNS("http://www.w3.org/1999/xhtml",
"canvas");u.width=h.Math.nearestPowerOfTwo(n.width);u.height=h.Math.nearestPowerOfTwo(n.height);u.getContext("2d").drawImage(n,0,0,u.width,u.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+n.width+"x"+n.height+"). Resized to "+u.width+"x"+u.height,n);p=u}else p=n;var n=l(p),u=f(b.format),v=f(b.type);t(a.TEXTURE_2D,b,n);var q=b.mipmaps;if(b&&b.isDepthTexture){q=a.DEPTH_COMPONENT;if(1015===b.type){if(!w)throw Error("Float Depth Texture only supported in WebGL2.0");q=a.DEPTH_COMPONENT32F}else w&&
(q=a.DEPTH_COMPONENT16);1027===b.format&&(q=a.DEPTH_STENCIL);c.texImage2D(a.TEXTURE_2D,0,q,p.width,p.height,0,u,v,null)}else if(b&&b.isDataTexture)if(0<q.length&&n){for(var I=0,da=q.length;I<da;I++)p=q[I],c.texImage2D(a.TEXTURE_2D,I,u,p.width,p.height,0,u,v,p.data);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,u,p.width,p.height,0,u,v,p.data);else if(b&&b.isCompressedTexture)for(I=0,da=q.length;I<da;I++)p=q[I],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(u)?
c.compressedTexImage2D(a.TEXTURE_2D,I,u,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(a.TEXTURE_2D,I,u,p.width,p.height,0,u,v,p.data);else if(0<q.length&&n){I=0;for(da=q.length;I<da;I++)p=q[I],c.texImage2D(a.TEXTURE_2D,I,u,u,v,p);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,u,u,v,p);b.generateMipmaps&&n&&a.generateMipmap(a.TEXTURE_2D);m.__version=b.version;if(b.onUpdate)b.onUpdate(b);
return}}c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture)}function t(c,g,k){k?(a.texParameteri(c,a.TEXTURE_WRAP_S,f(g.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,f(g.wrapT)),a.texParameteri(c,a.TEXTURE_MAG_FILTER,f(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,f(g.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),1001===g.wrapS&&1001===g.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",
g),a.texParameteri(c,a.TEXTURE_MAG_FILTER,m(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,m(g.minFilter)),1003!==g.minFilter&&1006!==g.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",g));!(k=b.get("EXT_texture_filter_anisotropic"))||1015===g.type&&null===b.get("OES_texture_float_linear")||1016===g.type&&null===b.get("OES_texture_half_float_linear")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||
(a.texParameterf(c,k.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g.anisotropy,e.getMaxAnisotropy())),d.get(g).__currentAnisotropy=g.anisotropy)}function u(b,e,g,k){var l=f(e.texture.format),m=f(e.texture.type);c.texImage2D(k,0,l,e.width,e.height,0,l,m,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,k,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function v(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,
a.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var y=g.memory,w="undefined"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext;
this.setTexture2D=n;this.setTextureCube=function(b,g){var m=d.get(b);if(6===b.image.length)if(0<b.version&&m.__version!==b.version){m.__image__webglTextureCube||(b.addEventListener("dispose",r),m.__image__webglTextureCube=a.createTexture(),y.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_CUBE_MAP,m.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);for(var n=b&&b.isCompressedTexture,h=b.image[0]&&b.image[0].isDataTexture,p=[],u=0;6>u;u++)p[u]=n||h?h?b.image[u].image:
b.image[u]:k(b.image[u],e.maxCubemapSize);var v=l(p[0]),q=f(b.format),w=f(b.type);t(a.TEXTURE_CUBE_MAP,b,v);for(u=0;6>u;u++)if(n)for(var ba,C=p[u].mipmaps,Da=0,M=C.length;Da<M;Da++)ba=C[Da],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(q)?c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+u,Da,q,ba.width,ba.height,0,ba.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+
u,Da,q,ba.width,ba.height,0,q,w,ba.data);else h?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,q,p[u].width,p[u].height,0,q,w,p[u].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,q,q,w,p[u]);b.generateMipmaps&&v&&a.generateMipmap(a.TEXTURE_CUBE_MAP);m.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+g),c.bindTexture(a.TEXTURE_CUBE_MAP,m.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,e){c.activeTexture(a.TEXTURE0+e);c.bindTexture(a.TEXTURE_CUBE_MAP,
d.get(b).__webglTexture)};this.setupRenderTarget=function(b){var e=d.get(b),f=d.get(b.texture);b.addEventListener("dispose",p);f.__webglTexture=a.createTexture();y.textures++;var g=b&&b.isWebGLRenderTargetCube,k=l(b);if(g){e.__webglFramebuffer=[];for(var m=0;6>m;m++)e.__webglFramebuffer[m]=a.createFramebuffer()}else e.__webglFramebuffer=a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);t(a.TEXTURE_CUBE_MAP,b.texture,k);for(m=0;6>m;m++)u(e.__webglFramebuffer[m],b,a.COLOR_ATTACHMENT0,
a.TEXTURE_CUBE_MAP_POSITIVE_X+m);b.texture.generateMipmaps&&k&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),t(a.TEXTURE_2D,b.texture,k),u(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&k&&a.generateMipmap(a.TEXTURE_2D),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=b&&b.isWebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error("target.depthTexture not supported in Cube render targets");
if(b&&b.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!b.depthTexture||!b.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=
!0);n(b.depthTexture,0);e=d.get(b.depthTexture).__webglTexture;if(1026===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,e,0);else if(1027===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,e,0);else throw Error("Unknown depthTexture format");}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),v(e.__webglDepthbuffer[f],
b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),v(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(b){var e=b.texture;e.generateMipmaps&&l(b)&&1003!==e.minFilter&&1006!==e.minFilter&&(b=b&&b.isWebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,e=d.get(e).__webglTexture,c.bindTexture(b,e),a.generateMipmap(b),c.bindTexture(b,null))}}function fa(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||
0;this.w=void 0!==d?d:1}function ce(a,b,c){function d(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}function e(b){!0!==F[b]&&(a.enable(b),F[b]=!0)}function f(b){!1!==F[b]&&(a.disable(b),F[b]=!1)}function g(b,d,g,k,l,m,n,h){if(0!==b){e(a.BLEND);if(b!==D||h!==Da)2===b?h?(a.blendEquationSeparate(a.FUNC_ADD,
a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):3===b?h?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):4===b?h?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):
h?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),D=b,Da=h;if(5===b){l=l||d;m=m||g;n=n||k;if(d!==K||l!==da)a.blendEquationSeparate(c(d),c(l)),K=d,da=l;if(g!==Ea||k!==I||m!==ba||n!==C)a.blendFuncSeparate(c(g),c(k),c(m),c(n)),Ea=g,I=k,ba=m,C=n}else C=ba=da=I=Ea=K=null}else f(a.BLEND),D=b}function k(a){v.setFunc(a)}
function l(b){M!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),M=b)}function m(b){0!==b?(e(a.CULL_FACE),b!==O&&(1===b?a.cullFace(a.BACK):2===b?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):f(a.CULL_FACE);O=b}function h(b){void 0===b&&(b=a.TEXTURE0+W-1);J!==b&&(a.activeTexture(b),J=b)}function p(a,b,c,d){u.setClear(a,b,c,d)}function n(a){v.setClear(a)}function t(a){q.setClear(a)}var u=new function(){var b=!1,c=new fa,d=null,e=new fa;return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},
setLocked:function(a){b=a},setClear:function(b,d,f,g){c.set(b,d,f,g);!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=!1;d=null;e.set(0,0,0,1)}}},v=new function(){var b=!1,c=null,d=null,g=null;return{setTest:function(b){b?e(a.DEPTH_TEST):f(a.DEPTH_TEST)},setMask:function(d){c===d||b||(a.depthMask(d),c=d)},setFunc:function(b){if(d!==b){if(b)switch(b){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);
break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);d=b}},setLocked:function(a){b=a},setClear:function(b){g!==b&&(a.clearDepth(b),g=b)},reset:function(){b=!1;g=d=c=null}}},q=new function(){var b=!1,c=null,d=null,g=null,k=null,l=null,m=null,n=null,h=null;return{setTest:function(b){b?e(a.STENCIL_TEST):f(a.STENCIL_TEST)},setMask:function(d){c===d||b||
(a.stencilMask(d),c=d)},setFunc:function(b,c,e){if(d!==b||g!==c||k!==e)a.stencilFunc(b,c,e),d=b,g=c,k=e},setOp:function(b,c,d){if(l!==b||m!==c||n!==d)a.stencilOp(b,c,d),l=b,m=c,n=d},setLocked:function(a){b=a},setClear:function(b){h!==b&&(a.clearStencil(b),h=b)},reset:function(){b=!1;h=n=m=l=k=g=d=c=null}}},w=a.getParameter(a.MAX_VERTEX_ATTRIBS),x=new Uint8Array(w),N=new Uint8Array(w),z=new Uint8Array(w),F={},G=null,D=null,K=null,Ea=null,I=null,da=null,ba=null,C=null,Da=!1,M=null,O=null,P=null,S=null,
B=null,V=null,W=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),J=null,E={},R=new fa,H=new fa,Wa={};Wa[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);Wa[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:u,depth:v,stencil:q},init:function(){p(0,0,0,1);n(1);t(0);e(a.DEPTH_TEST);k(3);l(!1);m(1);e(a.CULL_FACE);e(a.BLEND);g(1)},initAttributes:function(){for(var a=0,b=x.length;a<b;a++)x[a]=0},enableAttribute:function(c){x[c]=1;0===N[c]&&(a.enableVertexAttribArray(c),
N[c]=1);0!==z[c]&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,0),z[c]=0)},enableAttributeAndDivisor:function(b,c,d){x[b]=1;0===N[b]&&(a.enableVertexAttribArray(b),N[b]=1);z[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),z[b]=c)},disableUnusedAttributes:function(){for(var b=0,c=N.length;b!==c;++b)N[b]!==x[b]&&(a.disableVertexAttribArray(b),N[b]=0)},enable:e,disable:f,getCompressedTextureFormats:function(){if(null===G&&(G=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||
b.get("WEBGL_compressed_texture_etc1")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<c.length;d++)G.push(c[d]);return G},setBlending:g,setColorWrite:function(a){u.setMask(a)},setDepthTest:function(a){v.setTest(a)},setDepthWrite:function(a){v.setMask(a)},setDepthFunc:k,setStencilTest:function(a){q.setTest(a)},setStencilWrite:function(a){q.setMask(a)},setStencilFunc:function(a,b,c){q.setFunc(a,b,c)},setStencilOp:function(a,b,c){q.setOp(a,b,c)},setFlipSided:l,setCullFace:m,setLineWidth:function(b){b!==
P&&(a.lineWidth(b),P=b)},setPolygonOffset:function(b,c,d){if(b){if(e(a.POLYGON_OFFSET_FILL),S!==c||B!==d)a.polygonOffset(c,d),S=c,B=d}else f(a.POLYGON_OFFSET_FILL)},getScissorTest:function(){return V},setScissorTest:function(b){(V=b)?e(a.SCISSOR_TEST):f(a.SCISSOR_TEST)},activeTexture:h,bindTexture:function(b,c){null===J&&h();var d=E[J];void 0===d&&(d={type:void 0,texture:void 0},E[J]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||Wa[b]),d.type=b,d.texture=c},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,
arguments)}catch(b){console.error(b)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}},clearColor:p,clearDepth:n,clearStencil:t,scissor:function(b){!1===R.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),R.copy(b))},viewport:function(b){!1===H.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),H.copy(b))},reset:function(){for(var b=0;b<N.length;b++)1===N[b]&&(a.disableVertexAttribArray(b),N[b]=0);F={};J=G=null;E={};O=M=D=null;u.reset();v.reset();q.reset()}}}function mb(a,b,c){this.uuid=
h.Math.generateUUID();this.width=a;this.height=b;this.scissor=new fa(0,0,a,b);this.scissorTest=!1;this.viewport=new fa(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=1006);this.texture=new Z(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.depthTexture=void 0!==c.depthTexture?c.depthTexture:null}function T(){Object.defineProperty(this,
"id",{value:de++});this.uuid=h.Math.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=
this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function Ha(a){T.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=
this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}function H(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)}function Xa(a){T.call(this);this.type=
"MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function Ja(a,b){this.min=void 0!==a?a:new q(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new q(-Infinity,-Infinity,-Infinity)}function za(a,b){this.center=void 0!==a?a:new q;this.radius=void 0!==b?b:0}function sa(){this.elements=new Float32Array([1,
0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function ga(a,b){this.normal=void 0!==a?a:new q(1,0,0);this.constant=void 0!==b?b:0}function Tb(a,b,c,d,e,f){this.planes=[void 0!==a?a:new ga,void 0!==b?b:new ga,void 0!==c?c:new ga,void 0!==d?d:new ga,void 0!==e?e:new ga,void 0!==f?f:new ga]}function md(a,b,c,d){function e(b,c,d,e){var f=b.geometry,g;g=y;var k=b.customDepthMaterial;d&&(g=w,k=b.customDistanceMaterial);
k?g=k:(k=!1,c.morphTargets&&(f&&f.isBufferGeometry?k=f.morphAttributes&&f.morphAttributes.position&&0<f.morphAttributes.position.length:f&&f.isGeometry&&(k=f.morphTargets&&0<f.morphTargets.length)),b=b.isSkinnedMesh&&c.skinning,f=0,k&&(f|=1),b&&(f|=2),g=g[f]);a.localClippingEnabled&&!0===c.clipShadows&&0!==c.clippingPlanes.length&&(f=g.uuid,k=c.uuid,b=x[f],void 0===b&&(b={},x[f]=b),f=b[k],void 0===f&&(f=g.clone(),b[k]=f),g=f);g.visible=c.visible;g.wireframe=c.wireframe;k=c.side;da.renderSingleSided&&
2==k&&(k=0);da.renderReverseSided&&(0===k?k=1:1===k&&(k=0));g.side=k;g.clipShadows=c.clipShadows;g.clippingPlanes=c.clippingPlanes;g.wireframeLinewidth=c.wireframeLinewidth;g.linewidth=c.linewidth;d&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(e);return g}function f(a,b,c){if(!1!==a.visible){0!==(a.layers.mask&b.layers.mask)&&(a.isMesh||a.isLine||a.isPoints)&&a.castShadow&&(!1===a.frustumCulled||!0===l.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,
a.matrixWorld),v.push(a));a=a.children;for(var d=0,e=a.length;d<e;d++)f(a[d],b,c)}}var g=a.context,k=a.state,l=new Tb,m=new R,r=b.shadows,p=new C,n=new C(d.maxTextureSize,d.maxTextureSize),t=new q,u=new q,v=[],y=Array(4),w=Array(4),x={},N=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],z=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)],F=[new fa,new fa,new fa,new fa,new fa,new fa];b=new Xa;b.depthPacking=3201;b.clipping=!0;d=nb.distanceRGBA;
for(var G=h.UniformsUtils.clone(d.uniforms),D=0;4!==D;++D){var K=0!==(D&1),Ea=0!==(D&2),I=b.clone();I.morphTargets=K;I.skinning=Ea;y[D]=I;K=new Ha({defines:{USE_SHADOWMAP:""},uniforms:G,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,morphTargets:K,skinning:Ea,clipping:!0});w[D]=K}var da=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(b,d){if(!1!==da.enabled&&(!1!==da.autoUpdate||!1!==da.needsUpdate)&&
0!==r.length){k.clearColor(1,1,1,1);k.disable(g.BLEND);k.setDepthTest(!0);k.setScissorTest(!1);for(var h,x,q=0,w=r.length;q<w;q++){var y=r[q],G=y.shadow;if(void 0===G)console.warn("THREE.WebGLShadowMap:",y,"has no shadow.");else{var D=G.camera;p.copy(G.mapSize);p.min(n);if(y&&y.isPointLight){h=6;x=!0;var K=p.x,I=p.y;F[0].set(2*K,I,K,I);F[1].set(0,I,K,I);F[2].set(3*K,I,K,I);F[3].set(K,I,K,I);F[4].set(3*K,0,K,I);F[5].set(K,0,K,I);p.x*=4;p.y*=2}else h=1,x=!1;null===G.map&&(G.map=new mb(p.x,p.y,{minFilter:1003,
magFilter:1003,format:1023}),D.updateProjectionMatrix());G&&G.isSpotLightShadow&&G.update(y);K=G.map;G=G.matrix;u.setFromMatrixPosition(y.matrixWorld);D.position.copy(u);a.setRenderTarget(K);a.clear();for(K=0;K<h;K++){x?(t.copy(D.position),t.add(N[K]),D.up.copy(z[K]),D.lookAt(t),k.viewport(F[K])):(t.setFromMatrixPosition(y.target.matrixWorld),D.lookAt(t));D.updateMatrixWorld();D.matrixWorldInverse.getInverse(D.matrixWorld);G.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);G.multiply(D.projectionMatrix);
G.multiply(D.matrixWorldInverse);m.multiplyMatrices(D.projectionMatrix,D.matrixWorldInverse);l.setFromMatrix(m);v.length=0;f(b,d,D);for(var I=0,Ea=v.length;I<Ea;I++){var C=v[I],B=c.update(C),E=C.material;if(E&&E.isMultiMaterial)for(var R=B.groups,E=E.materials,H=0,L=R.length;H<L;H++){var Q=R[H],T=E[Q.materialIndex];!0===T.visible&&(T=e(C,T,x,u),a.renderBufferDirect(D,null,B,T,C,Q))}else T=e(C,E,x,u),a.renderBufferDirect(D,null,B,T,C,null)}}}}h=a.getClearColor();x=a.getClearAlpha();a.setClearColor(h,
x);da.needsUpdate=!1}}}function af(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}function nd(a,b,c){var d=a.createShader(b);a.shaderSource(d,c);a.compileShader(d);!1===a.getShaderParameter(d,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==a.getShaderInfoLog(d)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",b===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(d),af(c));return d}function ee(){var a={};return{get:function(b){b=
b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c},"delete":function(b){delete a[b.uuid]},clear:function(){a={}}}}function fe(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a);}}function od(a,
b){var c=fe(b);return"vec4 "+a+"( vec4 value ) { return "+c[0]+"ToLinear"+c[1]+"; }"}function bf(a,b){var c=fe(b);return"vec4 "+a+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function cf(a,b){var c;switch(b){case 1:c="Linear";break;case 2:c="Reinhard";break;case 3:c="Uncharted2";break;case 4:c="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+b);}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function df(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||
b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ub).join("\n")}function ef(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+
c+" "+d)}return b.join("\n")}function Ub(a){return""!==a}function ge(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function pd(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,c){var d=Y[c];if(void 0===d)throw Error("Can not resolve #include <"+c+">");return pd(d)})}function he(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,
function(a,c,d,e){a="";for(c=parseInt(c);c<parseInt(d);c++)a+=e.replace(/\[ i \]/g,"[ "+c+" ]");return a})}function ie(a,b,c,d){var e=a.context,f=c.extensions,g=c.defines,k=c.__webglShader.vertexShader,l=c.__webglShader.fragmentShader,m="SHADOWMAP_TYPE_BASIC";1===d.shadowMapType?m="SHADOWMAP_TYPE_PCF":2===d.shadowMapType&&(m="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",n="ENVMAP_BLENDING_MULTIPLY";if(d.envMap){switch(c.envMap.mapping){case 301:case 302:h="ENVMAP_TYPE_CUBE";
break;case 306:case 307:h="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:h="ENVMAP_TYPE_EQUIREC";break;case 305:h="ENVMAP_TYPE_SPHERE"}switch(c.envMap.mapping){case 302:case 304:p="ENVMAP_MODE_REFRACTION"}switch(c.combine){case 0:n="ENVMAP_BLENDING_MULTIPLY";break;case 1:n="ENVMAP_BLENDING_MIX";break;case 2:n="ENVMAP_BLENDING_ADD"}}var t=0<a.gammaFactor?a.gammaFactor:1,f=df(f,d,a.extensions),u=ef(g),v=e.createProgram();c.isRawShaderMaterial?(g=[u,"\n"].filter(Ub).join("\n"),m=[f,u,"\n"].filter(Ub).join("\n")):
(g=["precision "+d.precision+" float;","precision "+d.precision+" int;","#define SHADER_NAME "+c.__webglShader.name,u,d.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+t,"#define MAX_BONES "+d.maxBones,d.map